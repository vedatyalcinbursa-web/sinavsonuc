<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Rahmiye Palabƒ±yƒ±k ƒ∞HO - Sƒ±nav Sonu√ß</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <style>
        :root {
            --primary-color: #c0392b; /* Bordo */
            --dark-color: #2c3e50;
            --bg-gradient: linear-gradient(135deg, #ece9e6 0%, #ffffff 100%);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-gradient);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            color: var(--dark-color);
        }

        .container {
            background-color: #fff;
            padding: 30px 20px;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
            position: relative;
            border-top: 5px solid var(--primary-color);
        }

        h1 { font-size: 1.2rem; color: var(--primary-color); margin-bottom: 5px; line-height: 1.4; font-weight: 700; }
        h3 { font-size: 0.9rem; font-weight: 500; color: #7f8c8d; margin-top: 0; margin-bottom: 20px; }

        /* A√ßƒ±klama Metni */
        .instruction {
            font-size: 0.85rem; color: #555;
            background-color: #f8f9fa; padding: 12px;
            border-radius: 10px; margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        /* Butonlar */
        button { 
            width: 100%; padding: 15px; 
            border: none; border-radius: 10px;
            cursor: pointer; font-size: 16px; font-weight: 600;
            transition: 0.2s; margin-bottom: 10px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        /* QR Butonu (Ana Buton) */
        .btn-qr { background-color: var(--dark-color); color: white; }
        .btn-qr:hover { background-color: #1a252f; }

        /* Elle Giri≈ü Butonu (ƒ∞kincil) */
        .btn-manual { background-color: #ecf0f1; color: var(--dark-color); border: 1px solid #bdc3c7;}
        .btn-manual:hover { background-color: #bdc3c7; }

        /* Sorgula Butonu */
        .btn-primary { background-color: var(--primary-color); color: white; margin-top: 5px;}
        .btn-primary:hover { background-color: #a93226; }

        /* Giri≈ü Alanƒ± (Ba≈ülangƒ±√ßta Gizli Olacak) */
        .manual-input-area {
            background: #fff4f2;
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed var(--primary-color);
            margin-top: 10px;
        }

        input[type="password"] { 
            width: 100%; padding: 12px;
            border: 2px solid #ddd; border-radius: 8px;
            box-sizing: border-box; font-size: 18px; text-align: center;
            letter-spacing: 3px; margin-bottom: 10px; background: white;
        }

        /* Kamera Alanƒ± */
        #reader { width: 100%; margin-bottom: 15px; display: none; border-radius: 10px; overflow: hidden; border: 2px solid var(--dark-color);}
        
        /* Tablo Tasarƒ±mƒ± */
        .result-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        .result-table th { background-color: var(--primary-color); color: white; padding: 10px; text-align: center; font-weight: 600; }
        .result-table th:first-child { border-top-left-radius: 8px; text-align: left; padding-left: 15px;}
        .result-table th:last-child { border-top-right-radius: 8px; }
        .result-table td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        .result-table td:first-child { text-align: left; padding-left: 15px; font-weight: 600; color: #555;}
        .result-table tr:nth-child(even) { background-color: #f9f9f9; }
        
        /* Puan Kartƒ± */
        .score-box { background: #fdf2f1; padding: 15px; border-radius: 15px; margin: 20px 0; border: 1px solid #fadbd8; }
        .big-score { font-size: 2.5rem; font-weight: 800; color: var(--primary-color); display: block; line-height: 1;}

        .hidden { display: none !important; }
        .error { color: #e74c3c; margin-top: 10px; font-size: 0.9rem; display: none; }
        .footer { margin-top: 25px; font-size: 0.75rem; color: #bdc3c7; border-top: 1px solid #f1f1f1; padding-top: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>RAHMƒ∞YE PALABIYIK<br>ƒ∞MAM HATƒ∞P ORTAOKULU</h1>
        <h3>Sƒ±nav Sonu√ß Ekranƒ±</h3>

        <div id="login-screen">
            <div class="instruction">
                Size verilen kimlik kartƒ±ndaki QR Kodu okutarak veya altƒ±ndaki ≈üifreyi girerek sonucunuzu √∂ƒürenebilirsiniz.
            </div>

            <div id="reader"></div>
            
            <button onclick="kameraAc()" class="btn-qr" id="qrBtn">üì∑ QR KOD ƒ∞LE Gƒ∞Rƒ∞≈û</button>
            <button onclick="kameraKapat()" class="btn-qr hidden" id="qrKapatBtn" style="background-color: #e74c3c;">‚ùå KAMERAYI KAPAT</button>
            
            <button onclick="elleGirisAc()" class="btn-manual" id="manualBtn">‚å®Ô∏è ELLE ≈ûƒ∞FRE Gƒ∞Rƒ∞≈ûƒ∞</button>

            <div id="manualArea" class="manual-input-area hidden">
                <input type="password" id="sifre" placeholder="≈ûƒ∞FRE" onkeyup="enterKontrol(event)">
                <button onclick="sorgula()" id="sorgulaBtn" class="btn-primary">SONUCU G√ñSTER</button>
            </div>

            <div id="hata-mesaji" class="error"></div>
        </div>

        <div id="result-screen" class="hidden">
            <h2 id="ogrenci-adi" style="color:#333; margin:0; font-size:1.4rem;"></h2>
            
            <div class="score-box">
                <span class="big-score" id="lgs-puani">000</span>
                <span style="font-size:0.8rem; color:#777;">TAHMƒ∞Nƒ∞ LGS PUANI</span>
            </div>
            
            <table class="result-table">
                <thead>
                    <tr>
                        <th width="40%">Ders</th>
                        <th width="20%">D</th>
                        <th width="20%">Y</th>
                        <th width="20%">Net</th>
                    </tr>
                </thead>
                <tbody id="tablo-govde">
                    </tbody>
            </table>

            <button onclick="location.reload()" style="background-color: #7f8c8d; margin-top: 20px;">√áƒ±kƒ±≈ü Yap</button>
        </div>

        <div class="footer">
            Hazƒ±rlayan: <strong>Vedat YAL√áIN</strong>
        </div>
    </div>

    <script>
        const hataKutusu = document.getElementById('hata-mesaji');
        const sorgulaBtn = document.getElementById('sorgulaBtn');
        let html5QrCode;

        function enterKontrol(event) {
            if (event.key === "Enter") sorgula();
        }

        // Elle Giri≈ü Alanƒ±nƒ± A√ßma
        function elleGirisAc() {
            document.getElementById('manualArea').classList.remove('hidden');
            document.getElementById('manualBtn').classList.add('hidden'); // Butonu gizle
            
            // Kamera a√ßƒ±ksa kapatalƒ±m ki karƒ±≈üƒ±klƒ±k olmasƒ±n
            if(!document.getElementById('qrKapatBtn').classList.contains('hidden')){
                kameraKapat();
            }
        }

        // --- KAMERA ƒ∞≈ûLEMLERƒ∞ ---
        function kameraAc() {
            // Elle giri≈ü a√ßƒ±ksa gizleyelim (temiz g√∂r√ºn√ºm i√ßin)
            document.getElementById('manualArea').classList.add('hidden');
            document.getElementById('manualBtn').classList.remove('hidden');

            document.getElementById('qrBtn').classList.add('hidden');
            document.getElementById('qrKapatBtn').classList.remove('hidden');
            document.getElementById('reader').style.display = "block";
            hataKutusu.style.display = "none";

            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            html5QrCode = new Html5Qrcode("reader");
            
            html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess, onScanFailure)
            .catch(err => {
                hataKutusu.innerText = "Kamera ba≈ülatƒ±lamadƒ±. ƒ∞zinleri kontrol edin.";
                hataKutusu.style.display = "block";
                kameraKapat();
            });
        }

        function kameraKapat() {
            if (html5QrCode) {
                html5QrCode.stop().then(() => {
                    document.getElementById('reader').style.display = "none";
                    document.getElementById('qrBtn').classList.remove('hidden');
                    document.getElementById('qrKapatBtn').classList.add('hidden');
                    html5QrCode = null;
                }).catch(err => console.log(err));
            } else {
                // Nesne yoksa bile UI'ƒ± d√ºzelt
                document.getElementById('reader').style.display = "none";
                document.getElementById('qrBtn').classList.remove('hidden');
                document.getElementById('qrKapatBtn').classList.add('hidden');
            }
        }

        function onScanSuccess(decodedText, decodedResult) {
            document.getElementById('sifre').value = decodedText; 
            kameraKapat(); 
            // Kullanƒ±cƒ±ya i≈ülemin ba≈üarƒ±lƒ± olduƒüunu hissettirip sorgula
            sorgula(); 
        }

        function onScanFailure(error) {}

        // --- SORGULAMA ƒ∞≈ûLEMLERƒ∞ ---
        async function sorgula() {
            const sifre = document.getElementById('sifre').value.trim();
            hataKutusu.style.display = "none";

            if (!sifre) {
                hataKutusu.innerText = "L√ºtfen ≈üifre giriniz.";
                hataKutusu.style.display = "block";
                return;
            }

            sorgulaBtn.innerText = "L√ºtfen Bekleyin...";
            sorgulaBtn.disabled = true;

            try {
                const response = await fetch(`veriler/${sifre}.json?v=${new Date().getTime()}`);
                if (!response.ok) throw new Error("Veri bulunamadƒ±");

                const veri = await response.json();
                setTimeout(() => { sonuclariGoster(veri); }, 400);

            } catch (error) {
                hataKutusu.innerText = "Hatalƒ± ≈üifre girdiniz.";
                hataKutusu.style.display = "block";
                sorgulaBtn.innerText = "SONUCU G√ñSTER";
                sorgulaBtn.disabled = false;
            }
        }

        function sonuclariGoster(veri) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');

            document.getElementById('ogrenci-adi').innerText = veri.ad;
            document.getElementById('lgs-puani').innerText = parseFloat(veri.puan).toFixed(3);

            const tabloGovde = document.getElementById('tablo-govde');
            tabloGovde.innerHTML = ''; 

            const dersAdlari = {
                'TR': 'T√ºrk√ße', 'MAT': 'Matematik', 'FEN': 'Fen Bil.', 
                'INK': 'ƒ∞nkƒ±lap', 'DIN': 'Din K.', 'ING': 'ƒ∞ngilizce'
            };
            const siralama = ['TR', 'MAT', 'FEN', 'INK', 'DIN', 'ING'];

            siralama.forEach(kod => {
                if(veri.dersler[kod]) {
                    const d = veri.dersler[kod];
                    const satir = `
                    <tr>
                        <td>${dersAdlari[kod]}</td>
                        <td>${d.d}</td>
                        <td>${d.y}</td>
                        <td><strong>${d.n}</strong></td>
                    </tr>`;
                    tabloGovde.innerHTML += satir;
                }
            });
        }
    </script>
</body>
</html>