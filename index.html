<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Rahmiye Palabƒ±yƒ±k ƒ∞HO - Sƒ±nav Sonu√ß</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <style>
        :root {
            --primary-color: #c0392b; /* Bordo */
            --bg-gradient: linear-gradient(135deg, #ece9e6 0%, #ffffff 100%);
            --text-dark: #2c3e50;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-gradient);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            color: var(--text-dark);
        }

        .container {
            background-color: #fff;
            padding: 30px 20px;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
            position: relative;
            border-top: 5px solid var(--primary-color);
        }

        h1 { font-size: 1.2rem; color: var(--primary-color); margin-bottom: 5px; line-height: 1.4; font-weight: 700; }
        h3 { font-size: 0.9rem; font-weight: 500; color: #7f8c8d; margin-top: 0; margin-bottom: 20px; }

        /* Giri≈ü Alanƒ± */
        input[type="password"] { 
            width: 100%; padding: 12px;
            border: 2px solid #ddd; border-radius: 8px;
            box-sizing: border-box; font-size: 18px; text-align: center;
            letter-spacing: 3px; margin-bottom: 10px;
        }
        
        button { 
            width: 100%; padding: 12px; 
            background-color: var(--primary-color);
            color: white; border: none; border-radius: 8px;
            cursor: pointer; font-size: 16px; font-weight: 600;
            transition: 0.2s; margin-top: 5px;
        }
        button:hover { background-color: #a93226; }

        .btn-qr {
            background-color: #34495e;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-qr:hover { background-color: #2c3e50; }

        /* Kamera Alanƒ± */
        #reader { width: 100%; margin-top: 10px; display: none; border-radius: 10px; overflow: hidden;}
        
        /* Tablo Tasarƒ±mƒ± */
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        .result-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: 600;
        }
        .result-table th:first-child { border-top-left-radius: 8px; text-align: left; padding-left: 15px;}
        .result-table th:last-child { border-top-right-radius: 8px; }
        
        .result-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }
        .result-table td:first-child { text-align: left; padding-left: 15px; font-weight: 600; color: #555;}
        .result-table tr:nth-child(even) { background-color: #f9f9f9; }
        
        /* Puan Kartƒ± */
        .score-box {
            background: #fdf2f1;
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid #fadbd8;
        }
        .big-score { font-size: 2.5rem; font-weight: 800; color: var(--primary-color); display: block; line-height: 1;}

        .hidden { display: none; }
        .error { color: #e74c3c; margin-top: 10px; font-size: 0.9rem; display: none; }
        .footer { margin-top: 25px; font-size: 0.75rem; color: #bdc3c7; border-top: 1px solid #f1f1f1; padding-top: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>RAHMƒ∞YE PALABIYIK<br>ƒ∞MAM HATƒ∞P ORTAOKULU</h1>
        <h3>Sƒ±nav Sonu√ß Ekranƒ±</h3>

        <div id="login-screen">
            <div id="reader"></div>

            <input type="password" id="sifre" placeholder="≈ûƒ∞FRE" onkeyup="enterKontrol(event)">
            
            <button onclick="sorgula()" id="sorgulaBtn">SONUCU G√ñSTER</button>
            <button onclick="kameraAc()" class="btn-qr" id="qrBtn">üì∑ QR KOD ƒ∞LE Gƒ∞Rƒ∞≈û</button>
            <button onclick="kameraKapat()" class="btn-qr hidden" id="qrKapatBtn" style="background-color: #e74c3c;">‚ùå KAMERAYI KAPAT</button>
            
            <div id="hata-mesaji" class="error"></div>
        </div>

        <div id="result-screen" class="hidden">
            <h2 id="ogrenci-adi" style="color:#333; margin:0; font-size:1.4rem;"></h2>
            
            <div class="score-box">
                <span class="big-score" id="lgs-puani">000</span>
                <span style="font-size:0.8rem; color:#777;">TAHMƒ∞Nƒ∞ LGS PUANI</span>
            </div>
            
            <table class="result-table">
                <thead>
                    <tr>
                        <th width="40%">Ders</th>
                        <th width="20%">D</th>
                        <th width="20%">Y</th>
                        <th width="20%">Net</th>
                    </tr>
                </thead>
                <tbody id="tablo-govde">
                    </tbody>
            </table>

            <button onclick="location.reload()" style="background-color: #7f8c8d; margin-top: 20px;">√áƒ±kƒ±≈ü Yap</button>
        </div>

        <div class="footer">
            Hazƒ±rlayan: <strong>Vedat YAL√áIN</strong>
        </div>
    </div>

    <script>
        const hataKutusu = document.getElementById('hata-mesaji');
        const sorgulaBtn = document.getElementById('sorgulaBtn');
        let html5QrCode;

        function enterKontrol(event) {
            if (event.key === "Enter") sorgula();
        }

        // --- KAMERA ƒ∞≈ûLEMLERƒ∞ ---
        function kameraAc() {
            document.getElementById('qrBtn').classList.add('hidden');
            document.getElementById('qrKapatBtn').classList.remove('hidden');
            document.getElementById('reader').style.display = "block";
            hataKutusu.style.display = "none";

            html5QrCode = new Html5Qrcode("reader");
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            
            html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess, onScanFailure)
            .catch(err => {
                hataKutusu.innerText = "Kamera ba≈ülatƒ±lamadƒ±. ƒ∞zinleri kontrol edin.";
                hataKutusu.style.display = "block";
            });
        }

        function kameraKapat() {
            if (html5QrCode) {
                html5QrCode.stop().then(() => {
                    document.getElementById('reader').style.display = "none";
                    document.getElementById('qrBtn').classList.remove('hidden');
                    document.getElementById('qrKapatBtn').classList.add('hidden');
                }).catch(err => console.log(err));
            }
        }

        function onScanSuccess(decodedText, decodedResult) {
            // QR okunduƒüunda √ßalƒ±≈üƒ±r
            document.getElementById('sifre').value = decodedText; // ≈ûifreyi kutuya yaz
            kameraKapat(); // Kamerayƒ± kapat
            sorgula(); // Otomatik sorgula
        }

        function onScanFailure(error) {
            // Okuma denemesi ba≈üarƒ±sƒ±zsa (hen√ºz kod g√∂r√ºlmediyse) burasƒ± √ßalƒ±≈üƒ±r, i≈ülem yapmaya gerek yok.
        }

        // --- SORGULAMA ƒ∞≈ûLEMLERƒ∞ ---
        async function sorgula() {
            const sifre = document.getElementById('sifre').value.trim();
            hataKutusu.style.display = "none";

            if (!sifre) {
                hataKutusu.innerText = "L√ºtfen ≈üifre giriniz.";
                hataKutusu.style.display = "block";
                return;
            }

            sorgulaBtn.innerText = "L√ºtfen Bekleyin...";
            sorgulaBtn.disabled = true;

            try {
                const response = await fetch(`veriler/${sifre}.json?v=${new Date().getTime()}`);
                if (!response.ok) throw new Error("Veri bulunamadƒ±");

                const veri = await response.json();
                setTimeout(() => { sonuclariGoster(veri); }, 400);

            } catch (error) {
                hataKutusu.innerText = "Hatalƒ± ≈üifre veya kayƒ±t bulunamadƒ±.";
                hataKutusu.style.display = "block";
                sorgulaBtn.innerText = "SONUCU G√ñSTER";
                sorgulaBtn.disabled = false;
            }
        }

        function sonuclariGoster(veri) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');

            document.getElementById('ogrenci-adi').innerText = veri.ad;
            document.getElementById('lgs-puani').innerText = parseFloat(veri.puan).toFixed(3);

            const tabloGovde = document.getElementById('tablo-govde');
            tabloGovde.innerHTML = ''; 

            const dersAdlari = {
                'TR': 'T√ºrk√ße', 'MAT': 'Matematik', 'FEN': 'Fen Bil.', 
                'INK': 'ƒ∞nkƒ±lap', 'DIN': 'Din K.', 'ING': 'ƒ∞ngilizce'
            };
            const siralama = ['TR', 'MAT', 'FEN', 'INK', 'DIN', 'ING'];

            siralama.forEach(kod => {
                if(veri.dersler[kod]) {
                    const d = veri.dersler[kod];
                    const satir = `
                    <tr>
                        <td>${dersAdlari[kod]}</td>
                        <td>${d.d}</td>
                        <td>${d.y}</td>
                        <td><strong>${d.n}</strong></td>
                    </tr>`;
                    tabloGovde.innerHTML += satir;
                }
            });
        }
    </script>
</body>
</html>